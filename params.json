{"name":"Cohesive","tagline":"WIP Comparison of modern javascript application architecture: debunking the \"heavy view\" myth floating about with regards to AngularJS to help the interested digest its paradigm shift ","body":"ï»¿# DOM Element Behaviour\r\n## Coupled or Cohesive\r\n\r\n### The Problem\r\n\r\nConsider the following:\r\n\r\n```javascript\r\nApp.prototype.init = function() {\r\n\tvar exampleView = new ExampleView($('.js-example'));\r\n}\r\n```\r\n\r\nWhen our app starts we find an arbitrary dom element (or elements) using \r\na *css class* name js-example and use that to create an instance of our ExampleView class.\r\n\r\n```javascript\r\nExampleView.prototype.createChildren = function() {\r\n\tthis.$card = this.$element.find('.js-card');\r\n\treturn this;\r\n};\r\n```\r\n\r\nWe find children using the *css class* name js-card.\r\n\r\n```javascript\r\nExampleView.prototype.enable = function() {\r\n\tthis.$card.on('click', this.onClickHandler)        \r\n\tthis.$card.addClass('flipped');\r\n};\r\n```\r\n\r\nThen we add **behaviour** to those dom elements using \r\njquery | zepto | *that other framework* to bind a function\r\nto our browser's implementation of the normalized 'click' event.\r\n\r\n```javascript\r\nExampleView.prototype.onClick = function(e) {\r\n\tthis.$card.toggleClass('flipped');\r\n};\r\n```\r\n\r\nWhat makes this a problem:\r\n\r\nOur code is now directly / functionally dependent on our not only our html's structure, \r\nbut also the names we choose to use in css.  \r\nKeep in mind css is something totally unrelated to behaviour:\r\n\r\n>\"a style sheet language used for describing the presentation semantics (the look and formatting) of a document written in a markup language\"\r\n [Wikipedia - CSS](http://en.wikipedia.org/wiki/Cascading_Style_Sheets)\r\n\r\nOur html is separate from this logic intentionally.  Because we want to keep our \r\nviews logic less and lightweight.  The biggest problem with this: *it is not apparent\r\nto any machine or person at first glance or after uninformed inspection that js-example\r\nis related to ExampleView 1:1 and js-card is related to it's children*. \r\n\r\nFurthermore:\r\n\r\n+ traversing the dom tree by the attributes of its nodes is costly; we are required though, \r\n  to do it to add behaviour\r\n+ our html is brittle, its structure is completely coupled if we intend to have functional behaviour\r\n+ our markup is intentionally less semantic\r\n\r\n### The obvious truth exposed\r\n\r\nIn 2002 the idea of unobtrusive javascript was [conceived](http://www.kryogenix.org/code/browser/aqlists/).   \r\nInternet Explorer 6 was on its way becoming the most widely used browser.  It followed little standards \r\nand is likely one of the worst web browsers in the short history of the internet.  This idea of \r\nunobtrusiveness was developed to mitigate its lack of adherence to standards.  \r\n\r\nThe [seven identified principles](http://en.wikipedia.org/wiki/Unobtrusive_JavaScript) of unobtrusive javascript:\r\n\r\n>\t1. Do not make any assumptions: Defensive programming techniques should allow for the possibilities that JavaScript may not run, \r\n>\t  the browser may not support expected methods, the HTML may have changed, unexpected input devices may be in use and other scripts \r\n>\t  may either not be present or may be encroaching on the global namespace.\r\n>\t2. Find your hooks and relationships, such as IDs and other aspects of the expected HTML.\r\n>\t3. Leave traversing individual DOM objects to the experts, such as to the CSS handler built into the browser where possible.\r\n>\t4. Understand browsers and users, particularly how they fail, what assumptions they make, and unusual configurations or usages.\r\n>\t5. Understand events, including how they 'bubble' and the features of the Event object that is passed to most event handlers.\r\n>\t6. Play well with other scripts by avoiding global function and variable names. \r\n>\t7. Work for the next developer by using self-explanatory variable and function names, creating logical and readable code, \r\n>\t  making dependencies obvious, and commenting any code that still might confuse.\r\n\r\n### The Internet Is Evolving\r\n\r\nThe seven principles defined in 2007 no longer apply.  The web was a much different place and we were writing web pages as \r\nparts of a larger web application, tracking state on a server, the now defunct Windows Mobile was our idea of a smartphone, \r\nand wap was a relevant term.  The web has changed vastly.  Apple created the iPhone and Google (and its contributors) created Android.  \r\nA few people bought a Windows Phone - which is by no means a similar operating system to its ancestor.  IE6 is finally almost dead, \r\n7 is dying, Microsoft has started an open source initiative (the only thing that remains unchanged is the existence of \r\nApple's \"Walled Garden\"; and shame on them for that).  Most importantly we are writing web *applications* in one page.  \r\nBusiness logic is sometimes written exlusively in javascript.  Noone uses type attributes on script tags because no \r\nother script language is relevant and thus its not required.  Our smartphones outpower the machines we used in 2007 \r\nat one tenth the size.  Etc.  \r\n\r\n#### Enough about that; about those seven principles:\r\n\r\n>\t+ Do not make any assumptions: Defensive programming techniques should allow for the possibilities that JavaScript may not run, \r\n>\t  the browser may not support expected methods, the HTML may have changed, unexpected input devices may be in use and other scripts \r\n>\t  may either not be present or may be encroaching on the global namespace.\r\n\r\nJavascript not running is no longer relevant.  If it doesn't run we may not have a single page let alone a functional web application.\r\nThe HTML may have changed.  If we are looking for ids, classes, traversing the DOM - pretty much if we have written any js and the HTML \r\nchanges (especially unexpectedly) said js is going to have to change with it.  Tiny code goblins shouldn't be messing around on github.\r\nUnexpected input devices may be in use.  This is a fundamental shift and brings us (back) to a very important concept: we no longer \r\nwrite code to support browser differences and likewise hardware differences.  It is the job of the device and its web browser to \r\ntranslate handwriting, speech, keyboard layouts, screen metrics.\r\n\r\n>\t+ Find your hooks and relationships, such as IDs and other aspects of the expected HTML.\r\n>\t+ Leave traversing individual DOM objects to the experts, such as to the CSS handler built into the browser where possible.\r\n\r\nTraverse and be merry.  Thou [hast plenty of unused cycles and battery cells](http://en.wikipedia.org/wiki/Sarcasm).  Remember to \r\nfully discharge your batteries between charges.  Especially the Lithium ion variety (don't really it will damage them).\r\n\r\n>\t+ Understand browsers and users, particularly how they fail, what assumptions they make, and unusual configurations or usages.\r\n\r\nThis should be revised for responsiveness and accessiblity.  We should no longer interpret this as perhaps the user has disabled \r\njavascript.  We can add something about whether they have connectivity and / or a gpu with nothing to do.\r\n\r\n>\t+ Understand events, including how they 'bubble' and the features of the Event object that is passed to most event handlers.\r\n\r\nPlease don't focus on plumbing code.  The inner workings of events should be the least of your worries.  Basic understanding is still required.\r\n\r\n>\t+ Play well with other scripts by avoiding global function and variable names. \r\n\r\nHas anyone outside of [Unity3D](http://unity3d.com) intentionally written code in a global scope for production?  Shame on you.  This still applies.\r\n\r\n>\t+ Work for the next developer by using self-explanatory variable and function names, creating logical and readable code, \r\n>\t  making dependencies obvious, and commenting any code that still might confuse.\r\n\r\nThis most definitely still applies.  But it should be noted that \r\n\r\n```javascript\r\nvar exampleView = new ExampleView($('.js-example'));\r\n```\r\nmeans and explains nothing.  It is also only readable in the context of the document(s) that use it.  Without type safety, compilation, and completely \r\nseparated - exactly what dependency is obvious to someone working on the document?  It is also not possible to understand the structural dependencies\r\nthat most definitely exist without fully understanding the behaviour.\r\n\r\n-------\r\n\r\n### HTML and js Are Lonely\r\n\r\nHave you ever written testable, readable, separated code in any other language - in this manner?  Probably (hopefully) not.  \r\nTo illustrate this, I've put a few examples together (not exactly the same implementation, but the concepts outlined remain):\r\n\r\n#### WPF: Xaml and C#\r\n\r\n[MainWindow.xaml](examples/xaml/MainWindow.xaml)\r\n\r\n```xml \r\n<Window x:Class=\"SeparationOfConcerns.MainWindow\"\r\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\r\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\r\n\t\t>\r\n  <Grid Name=\"exampleGrid\">\r\n    <Grid.ColumnDefinitions>\r\n      <ColumnDefinition />\r\n      <ColumnDefinition />\r\n      <ColumnDefinition />\r\n    </Grid.ColumnDefinitions>\r\n    <Rectangle Style=\"{StaticResource Card}\" Grid.Column=\"0\" />\r\n    <Rectangle Style=\"{StaticResource Card}\" Grid.Column=\"1\" />\r\n    <Rectangle Style=\"{StaticResource Card}\" Grid.Column=\"2\" />\r\n  </Grid>\r\n</Window>\r\n```\r\n\r\n[MainWindow.xaml.cs](examples/xaml/MainWindow.xaml.cs)\r\n\r\n```cs\r\nusing System.Windows;\r\nusing System.Windows.Media;\r\nusing System.Windows.Shapes;\r\nnamespace SeparationOfConcerns\r\n{\r\n  public partial class MainWindow : Window\r\n  {\r\n    public MainWindow()\r\n    {\r\n      InitializeComponent();\r\n      Init();\r\n    }\r\n\r\n    public void Init()\r\n    {\r\n      var cardStyle = App.Current.Resources[\"Card\"] as Style;\r\n      var flippedStyle = App.Current.Resources[\"Flipped\"] as Style;\r\n\r\n      var children = VisualTreeHelper.GetChildrenCount(exampleGrid);\r\n\r\n      for (var i = 0; i < children; i++)\r\n      {\r\n        var child = VisualTreeHelper.GetChild(exampleGrid, i) as Rectangle;\r\n\r\n        if (child != null && cardStyle != null && child.Style == cardStyle)\r\n        {\r\n          child.MouseLeave += (o, args) => child.Style = cardStyle;\r\n          child.MouseEnter += (o, args) => child.Style = flippedStyle;\r\n        }\r\n      }\r\n\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThis violates nearly every rule in the book for WPF applications.  It makes no sense.  Rebuttals welcome.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}